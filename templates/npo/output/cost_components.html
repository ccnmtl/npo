{% load get %}

{% for system, costs in cost_components.items %}
<h3>{{system}}</h3>
<table>
  <thead>
    <tr>
      <th scope="col">
	component
      </th>
      <th scope="col">
	cost (USD)
      </th>
      <th scope="col">
	percent of total cost
      </th>
    </tr>
  </thead>

  <tbody>
    {% for type, cost in costs.items %}
    <tr>
      <th scope="row">
	{{type}}
      </th>
      <td>
	${{cost}}
      </td>
      <td>
	{% with totals|getitem:system as total %}
	{{cost|percent_of:total}}
	{% endwith %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endfor %}

<div style="display: none;">
{% for system, cost in totals.items %}
{{system}}: {{cost}}
{% endfor %}
</div>
